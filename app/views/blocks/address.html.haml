%table.details
  %tr
    %th Address
    %th= @address 
  %tr
    %th Hash160
    %th= @hash160
  %tr
    %th Transactions
    %td= @txouts.size
  %tr
    %th Total Volume
    %td= format_amount(@txouts.map(&:value).sum)
  %tr
    %th Current Balance
    %th= format_amount(STORE.get_balance(Bitcoin.hash160_from_address(@address)))

%h3 Transactions

%table.list
  %tr
    %th Tx
    %th Block
    %th Address
    %th Type
    %th Value
    %th Total

  - total = 0
  - @txouts.each do |txout|
    - tx = txout.get_tx
    %tr{:class => cycle('odd', 'even')}
      %td= link_to(tx.hash, tx_path(tx.hash))
      %td
        - if block = tx.get_block
          = link_to(block.depth, block_path(block.hash))
        - else
          not yet
      - total += txout.value
      %td
        - txout.get_tx.in.each do |txin|
          - if txin.coinbase?
            generation
          - else
            - prev_out = txin.get_prev_out
            - if prev_out
              = link_to(prev_out.get_address, address_path(prev_out.get_address))
            - else
              unknown
            %br/
        %td.incoming= "->"
        %td.value= format_amount(txout.value)
        %td.value= format_amount(total)
    - if next_in = txout.get_next_in
      - tx = next_in.get_tx
      %tr{:class => cycle('odd', 'even')}
        - total -= txout.value
        %td= link_to(tx.hash, tx_path(tx.hash))
        %td
          - if block = tx.get_block
            = link_to(block.depth, block_path(block.hash))
          - else
            not yet
        %td
          - txout.get_next_in.get_tx.out.map(&:get_addresses).each do |addrs|
            - if addrs.is_a?(Array)
              = addrs.map{|a| link_to(a, address_path(a))}.join("<br/>").html_safe
            - else
              = link_to(addrs, address_path(addrs))
            %br/
        %td.outgoing= "<-"
        %td.value.outgoing= "- #{format_amount(txout.value)}"
        %td.value= format_amount(total)